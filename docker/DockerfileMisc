## base image
FROM ubuntu:22.04 AS base

ARG setup_cpp_linux_version="0.24.1"

# add setup_cpp https://github.com/aminya/setup-cpp
ADD https://github.com/aminya/setup-cpp/releases/download/v${setup_cpp_linux_version}/setup_cpp_linux /setup_cpp_linux
RUN chmod +x /setup_cpp_linux

ARG compiler="gcc"
# install cmake, ninja, and ccache
RUN /setup_cpp_linux --compiler $compiler --llvm true --cmake true --ninja true --ccache true --cppcheck true --vcpkg true --conan true --task true
#RUN cp /root/.cpprc /root/.bashrc

# install more tools
RUN python3 -m pip install cmake-format cmakelint

# install npx
RUN apt-get update && apt-get install -y \
    nodejs npm \
    && rm -rf /var/lib/apt/lists/*
RUN npm i -g npx

WORKDIR /home/project
ENV PROJECT_DIR /home/project

CMD source ~/.cpprc
COPY ./docker/entrypoint.sh /entrypoint.sh
ENTRYPOINT [ "/entrypoint.sh" ]


FROM base as lint
COPY . .
CMD  ["task", "lint"]
